<!DOCTYPE html>
<html lang="kr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>코딩테스트 연습</title>
  <!-- Standard css -->
  <link rel="icon" href="/img/logo/favicon.png">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
  <!-- pub-js link -->
  <script src="/js/pub-ui-custom.js"></script>
</head>
<body>
  <div class="challenge-navbar">
    <ol class="navbar-breadcrumb">
      <a href="/" class="navbar-logo"><img src="/img/logo/icon_b.png" alt="logo" style="height: 30px; margin-top: 5px;"></a>
      <li><a href="/learn/challenges/{rel}">코딩테스트 연습</a></li>
      <li><a href="/learn/challenges/{rel}">코딩 기초 트레이닝</a></li>
      <li class="active">아무개 문제</li>
    </ol>
  </div>

  <!-- 컨텐트 시작부 -->
  <div class="wrap">
    <div class="challenge-content">
      <!-- 제목 & 북마커 -->
      <div class="challenge-nav">
        <div class="nav-item">
          <i class="xi-bookmark-o"></i>
          <span class="challenge-title">아무개 문제</span>
        </div>
        <div class="nav-item">
          <div class="dropdown-language">
            <div class="dropdown-menu" id="language">
              <button type="button" class="dropdown-item btn-language" data-language="java">JAVA</button>
              <button type="button" class="dropdown-item btn-language" data-language="javascript">JavaScript</button>
              <button type="button" class="dropdown-item btn-language" data-language="sql">SQL</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 컨텐츠 영역 -->
      <div class="challenge-content-list">
        <div class="challenge-content-question">
          <h6 class="guide-section-title">문제 설명</h6>
          <div class="challenge-content-question-section">
            <p>정수 num1과 num2가 주어질 때, num1에서 num2를 뺀 값을 return하도록 soltuion 함수를 완성해주세요.
            </p>
            <code>제한사항<br>
				-50000 ≤ num1 ≤ 50000
				-50000 ≤ num2 ≤ 50000
              <!-- 변수 사용시 담아올값 data- 값으로 가져오기 -->
            </code><br>
            <br>
            <code>
            	입출력 예 설명<br>
				입출력 예 #1<br>

				num1이 2이고 num2가 3이므로 2 - 3 = -1을 return합니다.<br>
				입출력 예 #2<br>
				num1이 100이고 num2가 2이므로 100 - 2 = 98을 return합니다.
            </code>
          </div>
        </div>
        <div class="challenge-content-run">
          <h6 class="guide-section-title">코드 에디터</h6>
          <!-- CodeMirror -->
          <textarea id="batch_content" name="batch_content"></textarea>
          <h6 class="guide-section-title mt20">결과</h6>
          <div class="resultArea">
            <p id="output">실행 결과가 여기에 표시됩니다.</p>
          </div>
        </div>
      </div>
      <!-- 하단 보내기 값 -->
      <div class="bottom-list">
        <div class="testcase-button">
          <a href="/learn/courses/{reqno}" class="btn-show-question">질문하기</a>
        </div>
        <div class="func-buttons">
          <button class="btn_check" type="button" id="run">실행</button>
          <button class="btn_check" type="button" id="submit">제출</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CodeMirror Kit -->
  <script src="/js/codemirror/codemirror-5.65.18/lib/codemirror.js"></script>
  <script src="/js/codemirror/codemirror-5.65.18/mode/sql/sql.js"></script>
  <script src="/js/codemirror/codemirror-5.65.18/mode/javascript/javascript.js"></script>
  <link rel="stylesheet" href="/js/codemirror/codemirror-5.65.18/lib/codemirror.css">
  <link rel="stylesheet" href="/js/codemirror/codemirror-5.65.18/theme/monokai.css">
  <!-- Custom Script -->
  <script>
    // textarea element 가져오기
    let textarea_content = document.getElementById('batch_content');
    
    // CodeMirror 에디터 초기화
    var editor = CodeMirror.fromTextArea(textarea_content, {
      lineNumbers: true, 
      lineWrapping: true, 
      styleActiveLine: true, 
      foldGutter: true, 
      theme: "default",
      mode: 'text/x-sql', 
      gutter: true
    });

    let selectedLanguage = 'sql'; // 초기 언어
    const outputArea = document.getElementById("output");

    // 언어 버튼 클릭 시 모드 변경
    document.querySelectorAll('.btn-language').forEach(button => {
      button.addEventListener('click', function() {
        selectedLanguage = this.getAttribute('data-language');
        let mode = selectedLanguage === 'javascript' ? 'text/javascript' :
                   selectedLanguage === 'java' ? 'text/x-java' : 'text/x-sql';
        
        editor.setOption('mode', mode);
        editor.setValue(''); 
        outputArea.innerText = "실행 결과가 여기에 표시됩니다."; // 언어 변경 시 출력 초기화

        // 버튼 활성화 상태 업데이트
        document.querySelectorAll('.btn-language').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
      });
    });

    /*
    // 실행 버튼 클릭 시 코드 실행
    document.getElementById("run").addEventListener("click", function() {
      const code = editor.getValue();

      try {
        if (selectedLanguage === 'javascript') {
          let result = eval(code);
          outputArea.innerText = result;
        } else if (selectedLanguage === 'java') {
          outputArea.innerText = editor.getValue();
        } else if (selectedLanguage === 'sql') {
          outputArea.innerText = editor.getValue();
        }
      } catch (error) {
        outputArea.innerText = "오류 발생: " + error.message;
      }
    });
    */
    
	// 실행 버튼 클릭 시 코드 실행
    document.getElementById("submit").addEventListener("click", function() {
      const code = editor.getValue();
      const language = selectedLanguage;
      
      fetch('/submit', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
          'code': code,
          'language': selectedLanguage
        })
      })
      .then(response => response.text())
      .then(data => {
        outputArea.innerText = data; // 서버에서 받은 결과 표시
      })
      .catch(error => {
        outputArea.innerText = "오류 발생: " + error.message;
      });
    });
  </script>
</body>
</html>
