<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²Œì‹œíŒ</title>
  <!-- Standard css -->
  <link rel="icon" href="/img/logo/favicon.png">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
  <!-- pub-js link -->
  <script src="/js/pub-ui-custom.js"></script>
</head>

<body>
  <!-- header ì˜ì—­ -->
  <div id="header" th:replace="~{ /include/header }"></div>
  <div class="banner-zone">
    <!-- ì²«ë²ˆì§¸ ì˜ì—­ : ë‚˜ì¤‘ì— ë³´ì-->
    <div class="banner-content">
      <div class="content-banner-title">
        <h3>ëˆ„êµ¬ë‚˜ ğŸ™Œ ììœ ë¡­ê²Œ ì±„íŒ…ë°©ì— ì°¸ì—¬í•´ ë³´ì„¸ìš”</h3>
        <p>ì§„ë¡œ ìƒë‹´ ë¬¸ì œ ì§ˆë¬¸</p>
        <p>ë“± ë‹¤ì–‘í•œ ì£¼ì œë¡œ ëŒ€í™”ì— ì°¸ì—¬í•´ ë³´ì„¸ìš”</p>
      </div>
      <div class="content-banner-img" style="padding-top: 40px;">
        <img src="/img/message.png" alt="" style="position: relative; top: 30px; width: 150px;">
        <img src="/img/aset02.png" alt="" style="position: relative; width: 80px; right: 30px; bottom: 55px;">
      </div>
    </div>
  </div>
  <div class="container">
    <div class="main-content mt50">
      <div class="chat-title-nav">
        <div class="chat-title clearfix">
          <h4>ì±„íŒ… ê²€ìƒ‰</h4>
          <div class="search-inp">
            <input type="text" name="" id="search-room" placeholder="ì±„íŒ…ë°© ì œëª© ë˜ëŠ” ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•´ ì£¼ì„¸ìš”" onkeyup="filterChatRooms()">
          </div>
          <hr class="dashed mt20 mb20">
          <div class="chat-tag-wrap">
            <h4>íƒœê·¸ë³„ ëª¨ì•„ë³´ê¸°</h4>
            <div class="chat-tag-title">
              <button>ììœ ì£¼ì œ</button>
              <button>ì»¤ë¦¬ì–´ê³ ë¯¼</button>
              <button>ì§ˆë¬¸í•˜ê¸°</button>
              <button>ë¬¸ì œì§ˆë¬¸</button>
            </div>
            <hr class="dashed mt20 mb20">
            <div class="chat-tag-item">
              <!-- ë²„íŠ¼ í´ë¦­ì‹œ ì¶”ê°€ ë˜ê³  -> í•´ë‹¹ ë²„íŠ¼ í´ë¦­ì‹œ íƒœê·¸ ì‚­ì œ ë¨ -->
              <button>ììœ ì£¼ì œ</button>
              <!-- 
                <button>ì»¤ë¦¬ì–´ê³ ë¯¼</button>
                <button>ì§ˆë¬¸í•˜ê¸°</button>
                <button>ë¬¸ì œì§ˆë¬¸</button>
              -->
            </div>
            <p></p>
          </div>
          <div class="filter-group">
            <button class="filter">í•„í„° ì´ˆê¸°í™”</button>
            <button class="filter">í•„í„° ê²€ìƒ‰</button>
          </div>
        </div>
      </div>
      
	  <!-- ì±„íŒ…ë°© ì˜ì—­ -->
      <div class="content-chat-wrap">
        <details open>
          <summary><i class="xi-forum-o"></i>ì»¨í…ì¸  ì˜ì—­</summary>
          <div class="chat-list">
            <div class="chat-list-head">
              <button onclick="createRoomPopup()">ì±„íŒ…ë°© ê°œì„¤</button>
            </div>
            <div class="chat-list-item">
              <img src="/img/test-profile/handyping.png" alt="ì´ë¯¸ì§€ ë“±ë¡ ì•ˆí–ˆì„ ê²½ìš°ì— ë°©ì¥ ì´ë¯¸ì§€ë¡œ" >
              <ol>
                <li class="title"><a href="/chat/chatview">ììœ ë¡œìš´ ëŒ€í™”ë¥¼ í•˜ëŠ” ë°©</a></li>
                <li class="tag">
                  <a href="#"><span class="card-small-red-tag">ììœ ì£¼ì œ</span></a>
                  <a href="#"><span class="card-small-yellow-tag">ì»¤ë¦¬ì–´ê³ ë¯¼</span></a>
                  <a href="#"><span class="card-small-green-tag">ì§ˆë¬¸í•˜ê¸°</span></a>
                  <a href="#"><span class="card-small-blue-tag">ë¬¸ì œì§ˆë¬¸</span></a>
                </li>
                <li class="meet-user"><a href="#">ì°¸ì—¬ì ìˆ˜ </a><span>{count}</span></li>
              </ol>
            </div>
            <!-- ì±„íŒ…ë°© ëª©ë¡ -->
            <div th:each="chatRoom : ${chatRooms}" class="chat-list-item" id="chatRoom-list-item">
              <img src="/img/test-profile/handyping.png" alt="ì´ë¯¸ì§€ ë“±ë¡ ì•ˆí–ˆì„ ê²½ìš°ì— ë°©ì¥ ì´ë¯¸ì§€ë¡œ" >
              
                <ol>
                  <li class="room">
               	    <b><a href="#">[[${chatRoom.title}]]</a></b>
               	    <p>ì°¸ì—¬ì ìˆ˜</p>
               	    <p id="entry" th:if="${chatRoom.limit == 0}">[[${memberCounts[chatRoom.idx]}]]</p>
            		<p id="entry" th:unless="${chatRoom.limit == 0}">[[${memberCounts[chatRoom.idx]}]] / [[${chatRoom.limit}]]</p>
               	    <p hidden>[[${chatRoom.idx}]]</p>
                  </li>
                </ol>
                
            </div>
            <!-- ì±„íŒ…ë°© ëª©ë¡ E -->
            
          </div>
        </details>
      </div>

	  <!-- ìœ ì € ì˜ì—­ -->
      <div class="content-chat-wrap">
        <details>
          <summary><i class="xi-speech-o"></i>ìœ ì € ë¦¬ìŠ¤íŠ¸ <span th:text="${members.size()}"></span>ëª…</summary>
          <div class="chat-list" id="user-list">
            <div class="chat-list-head">
              <button id="search-btn">ìœ ì € ê²€ìƒ‰</button>
              <input type="text" id="search-user" style="display:none;" placeholder="ì°¾ê³  ì‹¶ì€ ìœ ì €ë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.">
            </div>
            <div class="chat-list-item">
              <img src="/img/test-profile/handyping.png" alt="ì´ë¯¸ì§€ ë“±ë¡ ì•ˆí–ˆì„ ê²½ìš°ì— ë°©ì¥ ì´ë¯¸ì§€ë¡œ" >
              <ol>
                <li class="user">
                  <b><a href="#">ê¹€ì•„ë¬´ê°œ</a></b>
                  <p>ë ˆë²¨ 999</p>
                </li>
              </ol>
            </div>
            <!-- ìœ ì € ì •ë³´ -->
            <div th:each="member : ${members}" class="chat-list-item" id="user-list-item">
              <img src="/img/test-profile/handyping.png" alt="ì´ë¯¸ì§€ ë“±ë¡ ì•ˆí–ˆì„ ê²½ìš°ì— ë°©ì¥ ì´ë¯¸ì§€ë¡œ" >
              <ol>
                <li class="user" onkeyup="filterUsers()">
                  <b><a href="#">[[${member.username}]]</a></b>
                  <p hidden>[[${member.email}]]</p>
                  <!-- strings.substringë¥¼ ì‚¬ìš©í•˜ì—¬ ~ì˜ ~ë²ˆì§¸ ë¶€í„° ì¶œë ¥ -->
                  <p>ë ˆë²¨ <span th:text="${#numbers.formatInteger(#strings.substring(member.lvl, 4), 0)}"></span></p>
                </li>
              </ol>
            </div>
            <!-- ìœ ì € ì •ë³´ E -->
          </div>
        </details>
      </div>
    </div>
  </div>
  <!-- ì•„ì½”ë””ì–¸ ì˜ì—­ ì»¤ìŠ¤í…€ -- ë‚˜ì¤‘ì— -->
  <!-- https://apost.dev/1026/ -->
  <!-- https://developer.mozilla.org/en-US/docs/Web/HTML/Element/details -->
  <!-- footerì˜ì—­ -->
  <div id="footer" th:replace="~{ /include/footer }"></div>
</body>
<script>
	// ì²´íŒ…ë°© ê°œì„¤ íŒì—…ì°½
	function createRoomPopup () {
	  const options = 'width=700, height=600, top=50, left=5'
	  window.open('/chat/create','_blank',options)
	}
	
	// ìœ ì € ì •ë³´ íŒì—…ì°½
	function userInfoPopup () {
		const options = 'width=700, height=600, top=50, left=5'
		window.open('/chat/userinfo','_blank',options)
	}
	
	// ì±„íŒ…ë°© ì°¸ì—¬ì ìˆ˜
	
	
	// ì±„íŒ… ê²€ìƒ‰
	function filterChatRooms() {
	    var input, filter, chatList, chatItems, title, i, txtValue;
	    input = document.getElementById('search-room');
	    filter = input.value.toUpperCase();
	    chatList = document.getElementsByClassName('chat-list')[0];
	    chatItems = chatList.getElementsByClassName('chat-list-item');
	
	    for (i = 0; i < chatItems.length; i++) {
	        title = chatItems[i].getElementsByTagName('b')[0];
	        if (title) {
	            txtValue = title.textContent || title.innerText;
	            if (txtValue.toUpperCase().indexOf(filter) > -1) {
	                chatItems[i].style.display = "";
	            } else {
	                chatItems[i].style.display = "none";
	            }
	        }
	    }
	}
	
	// ìœ ì € ê²€ìƒ‰ ë²„íŠ¼ ëˆ„ë¥´ë©´ ê²€ìƒ‰ì¹¸ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
	document.getElementById('search-btn').addEventListener('click', function() {
        var searchUser = document.getElementById('search-user');
        if (searchUser.style.display === 'none') {
            searchUser.style.display = 'inline';
        } else {
            searchUser.style.display = 'none';
        }
    });

	// ìœ ì € ê²€ìƒ‰
	function filterUsers() {
		var input, filter, userList, userItems, username, i, txtValue;
	    input = document.getElementById('search-user');
	    filter = input.value.toUpperCase();
	    userList = document.getElementById('user-list');
	    userItems = userList.getElementsByClassName('chat-list-item');

	    for (i = 0; i < userItems.length; i++) {
	        username = userItems[i].getElementsByTagName('b')[0];
	        if (username) {
	            txtValue = username.textContent || username.innerText;
	            if (txtValue.toUpperCase().indexOf(filter) > -1) {
	                userItems[i].style.display = "";
	            } else {
	                userItems[i].style.display = "none";
	            }
	        }
	    }
	}   
	
	// ë ˆë²¨ ë°ì´í„° ê°€ê³µ
	document.addEventListener('DOMContentLoaded', function() {
		var levelElements = document.querySelectorAll('.user p span');
		levelElements.forEach(function(element) {
			var level = element.textContent;
			element.textContent = parseInt(level, 10);
		});
	});
	
	// ì±„íŒ…ë°© ì„ íƒ
	document.querySelectorAll('#chatRoom-list-item').forEach(item => {
		item.addEventListener('click', event => {
			alert('Chat room í´ë¦­ : \n' + event.target.innerText);
		});
	});
	
	// ìœ ì € ì´ë¦„ ì„ íƒ
	document.querySelectorAll('.user').forEach(item => {
	    item.addEventListener('click', event => {
	        const email = item.querySelector('p').textContent;
	        userInfoPopup(email);
	    });
	});
	
	// ìœ ì € ì±„íŒ…ë°© ìƒì„±
	document.querySelectorAll('#user-list-item').forEach(item => {
	    item.addEventListener('click', event => {
	        const email = item.querySelector('p').textContent;
	        createRoomPopup();
	    });
	});
	
	// ìœ ì € ì •ë³´ íŒì—…ì°½
	function userInfoPopup(email) {
	    const options = 'width=700, height=600, top=50, left=5';
	    window.open('/chat/userinfo?email=' + email, '_blank', options);
	}
	
	// ì±„íŒ…ë°© ì°¸ì—¬ ì—¬ë¶€
	
	
</script>
</html>